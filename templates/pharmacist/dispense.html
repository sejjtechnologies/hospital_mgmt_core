<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dispense Medication</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f8f9fa;
    }
    .navbar {
      padding: 0.5rem 1rem;
    }
    /* Back button styling */
    .back-button {
      margin-top: 1rem;
      margin-left: 1rem;
      background-color: #0d6efd; /* Bootstrap primary blue */
      color: white;
      border: none;
    }
    .back-button:hover {
      background-color: #0b5ed7;
      color: white;
    }
    h3 {
      margin-top: 1rem;
    }
    @media (max-width: 768px) {
      form .form-label {
        font-size: 0.9rem;
      }
      form .form-control, form .form-select, form .btn {
        font-size: 0.85rem;
      }
      .back-button {
        width: 100%;
        text-align: center;
        margin-left: 0;
        margin-bottom: 1rem;
      }
    }
  </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-success">
  <div class="container-fluid">
    <span class="navbar-brand fw-bold">Dispense Medication</span>
  </div>
</nav>

<!-- Back button below navbar -->
<a class="btn back-button" href="{{ url_for('pharmacist.pharmacist_dashboard') }}">Back</a>

<div class="container mt-4">
  <h3 class="fw-bold text-success">Dispense Medication</h3>
  <p class="text-muted">Select prescriptions and dispense drugs to patients.</p>

  <form method="POST" class="mt-4">
    <div class="mb-3">
      <label for="prescription_id" class="form-label">Select Prescription</label>
      <select class="form-select" id="prescription_id" name="prescription_id" required onchange="fillDetails(this)">
        <option value="">-- Choose Prescription --</option>
        {% for p in prescriptions %}
          <option value="{{ p.prescription_id }}"
                  data-med="{{ p.medication }}"
                  data-dosage="{{ p.dosage }}"
                  data-patient="{{ p.patient_id }}">
            {{ p.patient_name }} â€” {{ p.medication }} ({{ p.dosage }})
          </option>
        {% endfor %}
      </select>
    </div>

    <input type="hidden" name="patient_id" id="patient_id">

    <div class="mb-3">
      <label for="medication_name" class="form-label">Medication Name</label>
      <input type="text" class="form-control" id="medication_name" name="medication_name" readonly>
    </div>

    <div class="mb-3">
      <label for="dosage" class="form-label">Dosage</label>
      <input type="text" class="form-control" id="dosage" name="dosage" readonly>
    </div>

    <div class="mb-3">
      <label for="quantity_dispensed" class="form-label">Quantity to Dispense</label>
      <select class="form-select" id="quantity_dispensed" name="quantity_dispensed" required>
        <option value="">-- Select Quantity --</option>
        <option value="1">1 tablet</option>
        <option value="2">2 tablets</option>
        <option value="5">5 ml</option>
        <option value="10">10 ml</option>
        <option value="1">1 vial</option>
        <option value="1">1 injection</option>
        <option value="1">1 capsule</option>
        <option value="1">1 sachet</option>
        <option value="1">1 bottle</option>
      </select>
    </div>

    <div class="mb-3">
      <label for="notes" class="form-label">Dispensing Notes</label>
      <select class="form-select" id="notes" name="notes">
        <option value="">-- Select Note --</option>
        <option value="Take after meals">Take after meals</option>
        <option value="Take before meals">Take before meals</option>
        <option value="Take with plenty of water">Take with plenty of water</option>
        <option value="Store in fridge">Store in fridge</option>
        <option value="Avoid sunlight">Avoid sunlight</option>
        <option value="Shake well before use">Shake well before use</option>
        <option value="Complete full dose">Complete full dose</option>
        <option value="Do not crush or chew">Do not crush or chew</option>
        <option value="Apply externally only">Apply externally only</option>
      </select>
    </div>

    <button type="submit" class="btn btn-success">Dispense Medication</button>
  </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
function fillDetails(select) {
  const selected = select.options[select.selectedIndex];
  document.getElementById('medication_name').value = selected.dataset.med || '';
  document.getElementById('dosage').value = selected.dataset.dosage || '';
  document.getElementById('patient_id').value = selected.dataset.patient || '';
}
</script>
</body>
</html>
